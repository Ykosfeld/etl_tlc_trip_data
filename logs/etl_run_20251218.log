2025-12-18 15:18:15,510 - INFO - Starting Taxi ETL Pipeline
2025-12-18 15:18:20,000 - INFO - NumExpr defaulting to 12 threads.
2025-12-18 15:18:30,875 - INFO - Sessão do Spark criada
2025-12-18 15:18:30,876 - INFO - Lendo dados de taxis de data/yellow_tripdata_2025-10.parquet
2025-12-18 15:18:34,769 - INFO - Total de corridas carregadas: 4428699
2025-12-18 15:18:34,769 - INFO - Lendo dados de taxis de data/green_tripdata_2025-10.parquet
2025-12-18 15:18:34,908 - INFO - Total de corridas carregadas: 49416
2025-12-18 15:18:35,134 - INFO - O DataFrame combinado contém 4478115 corridas
2025-12-18 15:18:35,307 - INFO - Extraido 4478115 entradas cruas
2025-12-18 15:18:35,692 - ERROR - A pipeline falhou: replace_null_with_value() missing 1 required positional argument: 'correct_value'
2025-12-18 15:18:35,692 - ERROR - Traceback (most recent call last):
  File "/home/ykosfeld/Projetos/Meu_Python/LearningPyspark/etl_tlc_trip_data/run_etl.py", line 31, in run
    silver_df = final_clean(bronze_df)
  File "/home/ykosfeld/Projetos/Meu_Python/LearningPyspark/etl_tlc_trip_data/transform/clean.py", line 83, in final_clean
    clean_df = replace_null_with_value("Airport_fee", 0.0)
TypeError: replace_null_with_value() missing 1 required positional argument: 'correct_value'

2025-12-18 15:18:35,815 - INFO - Sessão do Spark encerrada
2025-12-18 15:18:35,816 - INFO - Closing down clientserver connection
2025-12-18 15:19:58,709 - INFO - Starting Taxi ETL Pipeline
2025-12-18 15:19:58,833 - INFO - NumExpr defaulting to 12 threads.
2025-12-18 15:20:01,158 - INFO - Sessão do Spark criada
2025-12-18 15:20:01,158 - INFO - Lendo dados de taxis de data/yellow_tripdata_2025-10.parquet
2025-12-18 15:20:03,504 - INFO - Total de corridas carregadas: 4428699
2025-12-18 15:20:03,504 - INFO - Lendo dados de taxis de data/green_tripdata_2025-10.parquet
2025-12-18 15:20:03,642 - INFO - Total de corridas carregadas: 49416
2025-12-18 15:20:03,855 - INFO - O DataFrame combinado contém 4478115 corridas
2025-12-18 15:20:04,004 - INFO - Extraido 4478115 entradas cruas
2025-12-18 15:20:04,580 - ERROR - A pipeline falhou: [UNRESOLVED_COLUMN.WITH_SUGGESTION] A column, variable, or function parameter with name `fate_amount` cannot be resolved. Did you mean one of the following? [`fare_amount`, `tip_amount`, `total_amount`, `tolls_amount`, `RatecodeID`]. SQLSTATE: 42703;
'Project [VendorID#0, passenger_count#3, trip_distance#4, RatecodeID#158, store_and_fwd_flag#6, PULocationID#7, DOLocationID#8, payment_type#157, fare_amount#10, extra#11, mta_tax#12, tip_amount#13, tolls_amount#14, improvement_surcharge#15, total_amount#16, congestion_surcharge#160, Airport_fee#159, cbd_congestion_fee#19, pickup_datetime#155, dropoff_datetime#156, trip_duration#161L, '`-`(total_amount#16, 'fate_amount) AS total_taxes#162]
+- Project [VendorID#0, passenger_count#3, trip_distance#4, RatecodeID#158, store_and_fwd_flag#6, PULocationID#7, DOLocationID#8, payment_type#157, fare_amount#10, extra#11, mta_tax#12, tip_amount#13, tolls_amount#14, improvement_surcharge#15, total_amount#16, congestion_surcharge#160, Airport_fee#159, cbd_congestion_fee#19, pickup_datetime#155, dropoff_datetime#156, timestampdiff(SECOND, pickup_datetime#155, dropoff_datetime#156, Some(America/Sao_Paulo)) AS trip_duration#161L]
   +- Project [VendorID#0, passenger_count#3, trip_distance#4, RatecodeID#158, store_and_fwd_flag#6, PULocationID#7, DOLocationID#8, payment_type#157, fare_amount#10, extra#11, mta_tax#12, tip_amount#13, tolls_amount#14, improvement_surcharge#15, total_amount#16, congestion_surcharge#160, Airport_fee#159, cbd_congestion_fee#19, pickup_datetime#155, dropoff_datetime#156]
      +- Project [VendorID#0, passenger_count#3, trip_distance#4, RatecodeID#158, store_and_fwd_flag#6, PULocationID#7, DOLocationID#8, payment_type#157, fare_amount#10, extra#11, mta_tax#12, tip_amount#13, tolls_amount#14, improvement_surcharge#15, total_amount#16, CASE WHEN isnull(congestion_surcharge#17) THEN 0.0 ELSE congestion_surcharge#17 END AS congestion_surcharge#160, Airport_fee#159, cbd_congestion_fee#19, ehail_fee#95, trip_type#96, pickup_datetime#155, dropoff_datetime#156]
         +- Project [VendorID#0, passenger_count#3, trip_distance#4, RatecodeID#158, store_and_fwd_flag#6, PULocationID#7, DOLocationID#8, payment_type#157, fare_amount#10, extra#11, mta_tax#12, tip_amount#13, tolls_amount#14, improvement_surcharge#15, total_amount#16, congestion_surcharge#17, CASE WHEN isnull(Airport_fee#18) THEN 0.0 ELSE Airport_fee#18 END AS Airport_fee#159, cbd_congestion_fee#19, ehail_fee#95, trip_type#96, pickup_datetime#155, dropoff_datetime#156]
            +- Project [VendorID#0, passenger_count#3, trip_distance#4, CASE WHEN (RatecodeID#5 = 99) THEN cast(null as int) ELSE RatecodeID#5 END AS RatecodeID#158, store_and_fwd_flag#6, PULocationID#7, DOLocationID#8, payment_type#157, fare_amount#10, extra#11, mta_tax#12, tip_amount#13, tolls_amount#14, improvement_surcharge#15, total_amount#16, congestion_surcharge#17, Airport_fee#18, cbd_congestion_fee#19, ehail_fee#95, trip_type#96, pickup_datetime#155, dropoff_datetime#156]
               +- Project [VendorID#0, passenger_count#3, trip_distance#4, RatecodeID#5, store_and_fwd_flag#6, PULocationID#7, DOLocationID#8, CASE WHEN (payment_type#9 = 5) THEN cast(null as int) ELSE payment_type#9 END AS payment_type#157, fare_amount#10, extra#11, mta_tax#12, tip_amount#13, tolls_amount#14, improvement_surcharge#15, total_amount#16, congestion_surcharge#17, Airport_fee#18, cbd_congestion_fee#19, ehail_fee#95, trip_type#96, pickup_datetime#155, dropoff_datetime#156]
                  +- Project [VendorID#0, passenger_count#3, trip_distance#4, RatecodeID#5, store_and_fwd_flag#6, PULocationID#7, DOLocationID#8, payment_type#9, fare_amount#10, extra#11, mta_tax#12, tip_amount#13, tolls_amount#14, improvement_surcharge#15, total_amount#16, congestion_surcharge#17, Airport_fee#18, cbd_congestion_fee#19, ehail_fee#95, trip_type#96, pickup_datetime#155, dropoff_datetime#156]
                     +- Project [VendorID#0, tpep_dropoff_datetime#2, passenger_count#3, trip_distance#4, RatecodeID#5, store_and_fwd_flag#6, PULocationID#7, DOLocationID#8, payment_type#9, fare_amount#10, extra#11, mta_tax#12, tip_amount#13, tolls_amount#14, improvement_surcharge#15, total_amount#16, congestion_surcharge#17, Airport_fee#18, cbd_congestion_fee#19, lpep_dropoff_datetime#94, ehail_fee#95, trip_type#96, pickup_datetime#155, coalesce(tpep_dropoff_datetime#2, lpep_dropoff_datetime#94) AS dropoff_datetime#156]
                        +- Project [VendorID#0, tpep_dropoff_datetime#2, passenger_count#3, trip_distance#4, RatecodeID#5, store_and_fwd_flag#6, PULocationID#7, DOLocationID#8, payment_type#9, fare_amount#10, extra#11, mta_tax#12, tip_amount#13, tolls_amount#14, improvement_surcharge#15, total_amount#16, congestion_surcharge#17, Airport_fee#18, cbd_congestion_fee#19, lpep_dropoff_datetime#94, ehail_fee#95, trip_type#96, pickup_datetime#155]
                           +- Project [VendorID#0, tpep_pickup_datetime#1, tpep_dropoff_datetime#2, passenger_count#3, trip_distance#4, RatecodeID#5, store_and_fwd_flag#6, PULocationID#7, DOLocationID#8, payment_type#9, fare_amount#10, extra#11, mta_tax#12, tip_amount#13, tolls_amount#14, improvement_surcharge#15, total_amount#16, congestion_surcharge#17, Airport_fee#18, cbd_congestion_fee#19, lpep_pickup_datetime#93, lpep_dropoff_datetime#94, ehail_fee#95, trip_type#96, coalesce(tpep_pickup_datetime#1, lpep_pickup_datetime#93) AS pickup_datetime#155]
                              +- Union false, false
                                 :- Project [VendorID#0, tpep_pickup_datetime#1, tpep_dropoff_datetime#2, passenger_count#3, trip_distance#4, RatecodeID#5, store_and_fwd_flag#6, PULocationID#7, DOLocationID#8, payment_type#9, fare_amount#10, extra#11, mta_tax#12, tip_amount#13, tolls_amount#14, improvement_surcharge#15, total_amount#16, congestion_surcharge#17, Airport_fee#18, cbd_congestion_fee#19, null AS lpep_pickup_datetime#93, null AS lpep_dropoff_datetime#94, null AS ehail_fee#95, null AS trip_type#96]
                                 :  +- Relation [VendorID#0,tpep_pickup_datetime#1,tpep_dropoff_datetime#2,passenger_count#3,trip_distance#4,RatecodeID#5,store_and_fwd_flag#6,PULocationID#7,DOLocationID#8,payment_type#9,fare_amount#10,extra#11,mta_tax#12,tip_amount#13,tolls_amount#14,improvement_surcharge#15,total_amount#16,congestion_surcharge#17,Airport_fee#18,cbd_congestion_fee#19] parquet
                                 +- Project [VendorID#44, null AS tpep_pickup_datetime#90, null AS tpep_dropoff_datetime#91, passenger_count#51, trip_distance#52, RatecodeID#48, store_and_fwd_flag#47, PULocationID#49, DOLocationID#50, payment_type#61, fare_amount#53, extra#54, mta_tax#55, tip_amount#56, tolls_amount#57, improvement_surcharge#59, total_amount#60, congestion_surcharge#63, null AS Airport_fee#92, cbd_congestion_fee#64, lpep_pickup_datetime#45, lpep_dropoff_datetime#46, ehail_fee#58, trip_type#62]
                                    +- Relation [VendorID#44,lpep_pickup_datetime#45,lpep_dropoff_datetime#46,store_and_fwd_flag#47,RatecodeID#48,PULocationID#49,DOLocationID#50,passenger_count#51,trip_distance#52,fare_amount#53,extra#54,mta_tax#55,tip_amount#56,tolls_amount#57,ehail_fee#58,improvement_surcharge#59,total_amount#60,payment_type#61,trip_type#62,congestion_surcharge#63,cbd_congestion_fee#64] parquet

2025-12-18 15:20:04,583 - ERROR - Traceback (most recent call last):
  File "/home/ykosfeld/Projetos/Meu_Python/LearningPyspark/etl_tlc_trip_data/run_etl.py", line 32, in run
    gold_df = enrich_trips(silver_df)
  File "/home/ykosfeld/Projetos/Meu_Python/LearningPyspark/etl_tlc_trip_data/transform/enrich.py", line 100, in enrich_trips
    df = add_total_taxes(df, "fate_amount", "total_amount")
  File "/home/ykosfeld/Projetos/Meu_Python/LearningPyspark/etl_tlc_trip_data/transform/enrich.py", line 37, in add_total_taxes
    return df.withColumn(
           ~~~~~~~~~~~~~^
        "total_taxes",
        ^^^^^^^^^^^^^^
        col(total_amount_col) - col(fare_amount_col)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/ykosfeld/miniconda3/envs/pyspark/lib/python3.14/site-packages/pyspark/python/lib/pyspark.zip/pyspark/sql/classic/dataframe.py", line 1623, in withColumn
    return DataFrame(self._jdf.withColumn(colName, col._jc), self.sparkSession)
                     ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/ykosfeld/miniconda3/envs/pyspark/lib/python3.14/site-packages/pyspark/python/lib/py4j-0.10.9.9-src.zip/py4j/java_gateway.py", line 1362, in __call__
    return_value = get_return_value(
        answer, self.gateway_client, self.target_id, self.name)
  File "/home/ykosfeld/miniconda3/envs/pyspark/lib/python3.14/site-packages/pyspark/python/lib/pyspark.zip/pyspark/errors/exceptions/captured.py", line 288, in deco
    raise converted from None
pyspark.errors.exceptions.captured.AnalysisException: [UNRESOLVED_COLUMN.WITH_SUGGESTION] A column, variable, or function parameter with name `fate_amount` cannot be resolved. Did you mean one of the following? [`fare_amount`, `tip_amount`, `total_amount`, `tolls_amount`, `RatecodeID`]. SQLSTATE: 42703;
'Project [VendorID#0, passenger_count#3, trip_distance#4, RatecodeID#158, store_and_fwd_flag#6, PULocationID#7, DOLocationID#8, payment_type#157, fare_amount#10, extra#11, mta_tax#12, tip_amount#13, tolls_amount#14, improvement_surcharge#15, total_amount#16, congestion_surcharge#160, Airport_fee#159, cbd_congestion_fee#19, pickup_datetime#155, dropoff_datetime#156, trip_duration#161L, '`-`(total_amount#16, 'fate_amount) AS total_taxes#162]
+- Project [VendorID#0, passenger_count#3, trip_distance#4, RatecodeID#158, store_and_fwd_flag#6, PULocationID#7, DOLocationID#8, payment_type#157, fare_amount#10, extra#11, mta_tax#12, tip_amount#13, tolls_amount#14, improvement_surcharge#15, total_amount#16, congestion_surcharge#160, Airport_fee#159, cbd_congestion_fee#19, pickup_datetime#155, dropoff_datetime#156, timestampdiff(SECOND, pickup_datetime#155, dropoff_datetime#156, Some(America/Sao_Paulo)) AS trip_duration#161L]
   +- Project [VendorID#0, passenger_count#3, trip_distance#4, RatecodeID#158, store_and_fwd_flag#6, PULocationID#7, DOLocationID#8, payment_type#157, fare_amount#10, extra#11, mta_tax#12, tip_amount#13, tolls_amount#14, improvement_surcharge#15, total_amount#16, congestion_surcharge#160, Airport_fee#159, cbd_congestion_fee#19, pickup_datetime#155, dropoff_datetime#156]
      +- Project [VendorID#0, passenger_count#3, trip_distance#4, RatecodeID#158, store_and_fwd_flag#6, PULocationID#7, DOLocationID#8, payment_type#157, fare_amount#10, extra#11, mta_tax#12, tip_amount#13, tolls_amount#14, improvement_surcharge#15, total_amount#16, CASE WHEN isnull(congestion_surcharge#17) THEN 0.0 ELSE congestion_surcharge#17 END AS congestion_surcharge#160, Airport_fee#159, cbd_congestion_fee#19, ehail_fee#95, trip_type#96, pickup_datetime#155, dropoff_datetime#156]
         +- Project [VendorID#0, passenger_count#3, trip_distance#4, RatecodeID#158, store_and_fwd_flag#6, PULocationID#7, DOLocationID#8, payment_type#157, fare_amount#10, extra#11, mta_tax#12, tip_amount#13, tolls_amount#14, improvement_surcharge#15, total_amount#16, congestion_surcharge#17, CASE WHEN isnull(Airport_fee#18) THEN 0.0 ELSE Airport_fee#18 END AS Airport_fee#159, cbd_congestion_fee#19, ehail_fee#95, trip_type#96, pickup_datetime#155, dropoff_datetime#156]
            +- Project [VendorID#0, passenger_count#3, trip_distance#4, CASE WHEN (RatecodeID#5 = 99) THEN cast(null as int) ELSE RatecodeID#5 END AS RatecodeID#158, store_and_fwd_flag#6, PULocationID#7, DOLocationID#8, payment_type#157, fare_amount#10, extra#11, mta_tax#12, tip_amount#13, tolls_amount#14, improvement_surcharge#15, total_amount#16, congestion_surcharge#17, Airport_fee#18, cbd_congestion_fee#19, ehail_fee#95, trip_type#96, pickup_datetime#155, dropoff_datetime#156]
               +- Project [VendorID#0, passenger_count#3, trip_distance#4, RatecodeID#5, store_and_fwd_flag#6, PULocationID#7, DOLocationID#8, CASE WHEN (payment_type#9 = 5) THEN cast(null as int) ELSE payment_type#9 END AS payment_type#157, fare_amount#10, extra#11, mta_tax#12, tip_amount#13, tolls_amount#14, improvement_surcharge#15, total_amount#16, congestion_surcharge#17, Airport_fee#18, cbd_congestion_fee#19, ehail_fee#95, trip_type#96, pickup_datetime#155, dropoff_datetime#156]
                  +- Project [VendorID#0, passenger_count#3, trip_distance#4, RatecodeID#5, store_and_fwd_flag#6, PULocationID#7, DOLocationID#8, payment_type#9, fare_amount#10, extra#11, mta_tax#12, tip_amount#13, tolls_amount#14, improvement_surcharge#15, total_amount#16, congestion_surcharge#17, Airport_fee#18, cbd_congestion_fee#19, ehail_fee#95, trip_type#96, pickup_datetime#155, dropoff_datetime#156]
                     +- Project [VendorID#0, tpep_dropoff_datetime#2, passenger_count#3, trip_distance#4, RatecodeID#5, store_and_fwd_flag#6, PULocationID#7, DOLocationID#8, payment_type#9, fare_amount#10, extra#11, mta_tax#12, tip_amount#13, tolls_amount#14, improvement_surcharge#15, total_amount#16, congestion_surcharge#17, Airport_fee#18, cbd_congestion_fee#19, lpep_dropoff_datetime#94, ehail_fee#95, trip_type#96, pickup_datetime#155, coalesce(tpep_dropoff_datetime#2, lpep_dropoff_datetime#94) AS dropoff_datetime#156]
                        +- Project [VendorID#0, tpep_dropoff_datetime#2, passenger_count#3, trip_distance#4, RatecodeID#5, store_and_fwd_flag#6, PULocationID#7, DOLocationID#8, payment_type#9, fare_amount#10, extra#11, mta_tax#12, tip_amount#13, tolls_amount#14, improvement_surcharge#15, total_amount#16, congestion_surcharge#17, Airport_fee#18, cbd_congestion_fee#19, lpep_dropoff_datetime#94, ehail_fee#95, trip_type#96, pickup_datetime#155]
                           +- Project [VendorID#0, tpep_pickup_datetime#1, tpep_dropoff_datetime#2, passenger_count#3, trip_distance#4, RatecodeID#5, store_and_fwd_flag#6, PULocationID#7, DOLocationID#8, payment_type#9, fare_amount#10, extra#11, mta_tax#12, tip_amount#13, tolls_amount#14, improvement_surcharge#15, total_amount#16, congestion_surcharge#17, Airport_fee#18, cbd_congestion_fee#19, lpep_pickup_datetime#93, lpep_dropoff_datetime#94, ehail_fee#95, trip_type#96, coalesce(tpep_pickup_datetime#1, lpep_pickup_datetime#93) AS pickup_datetime#155]
                              +- Union false, false
                                 :- Project [VendorID#0, tpep_pickup_datetime#1, tpep_dropoff_datetime#2, passenger_count#3, trip_distance#4, RatecodeID#5, store_and_fwd_flag#6, PULocationID#7, DOLocationID#8, payment_type#9, fare_amount#10, extra#11, mta_tax#12, tip_amount#13, tolls_amount#14, improvement_surcharge#15, total_amount#16, congestion_surcharge#17, Airport_fee#18, cbd_congestion_fee#19, null AS lpep_pickup_datetime#93, null AS lpep_dropoff_datetime#94, null AS ehail_fee#95, null AS trip_type#96]
                                 :  +- Relation [VendorID#0,tpep_pickup_datetime#1,tpep_dropoff_datetime#2,passenger_count#3,trip_distance#4,RatecodeID#5,store_and_fwd_flag#6,PULocationID#7,DOLocationID#8,payment_type#9,fare_amount#10,extra#11,mta_tax#12,tip_amount#13,tolls_amount#14,improvement_surcharge#15,total_amount#16,congestion_surcharge#17,Airport_fee#18,cbd_congestion_fee#19] parquet
                                 +- Project [VendorID#44, null AS tpep_pickup_datetime#90, null AS tpep_dropoff_datetime#91, passenger_count#51, trip_distance#52, RatecodeID#48, store_and_fwd_flag#47, PULocationID#49, DOLocationID#50, payment_type#61, fare_amount#53, extra#54, mta_tax#55, tip_amount#56, tolls_amount#57, improvement_surcharge#59, total_amount#60, congestion_surcharge#63, null AS Airport_fee#92, cbd_congestion_fee#64, lpep_pickup_datetime#45, lpep_dropoff_datetime#46, ehail_fee#58, trip_type#62]
                                    +- Relation [VendorID#44,lpep_pickup_datetime#45,lpep_dropoff_datetime#46,store_and_fwd_flag#47,RatecodeID#48,PULocationID#49,DOLocationID#50,passenger_count#51,trip_distance#52,fare_amount#53,extra#54,mta_tax#55,tip_amount#56,tolls_amount#57,ehail_fee#58,improvement_surcharge#59,total_amount#60,payment_type#61,trip_type#62,congestion_surcharge#63,cbd_congestion_fee#64] parquet


2025-12-18 15:20:04,801 - INFO - Sessão do Spark encerrada
2025-12-18 15:20:04,802 - INFO - Closing down clientserver connection
